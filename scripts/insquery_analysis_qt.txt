insert into ownerwithid(owner) select distinct _account_id from review;
insert into temp select review_id, count(*) from (select * from (select _account_id as owner,review_id from messages)A where (A.owner,A.review_id) not in (select _account_id as owner,review_id from review))B group by review_id;
insert into t1 select A.owner,B.cnt from ownerwithid A left join (select _account_id as owner,count(*) as cnt from `review` group by _account_id)B on A.owner=B.owner;
insert into t2 select A.owner,B.cnt  from ownerwithid A left join (SELECT _account_id as owner,count(*) as cnt FROM `approval` where status="ABANDONED" group by owner)B on A.owner=B.owner;
insert into t3 select A.owner,B.cnt  from ownerwithid A left join (SELECT _account_id as owner,count(*) as cnt FROM `approval` where status="MERGED" group by owner)B on A.owner=B.owner;
insert into t4 select A.owner,B.avg from ownerwithid A left join (select owner,avg(day) as avg from (SELECT _account_id as owner,datediff(updated,created) as day from review) C group by owner)B on A.owner=B.owner;
insert into t5 select A.owner,B.med from ownerwithid A left join (select owner,median(day) as med from (SELECT _account_id as owner,datediff(updated,created) as day from review) C group by owner)B on A.owner=B.owner;
insert into t6 select C.owner,B.avg from ownerwithid C left join (select owner,avg(day) as avg from (select owner,datediff(updated,created) as day from review E natural join (select _account_id as owner,review_id from approval where status='ABANDONED')A)D group by owner) B on C.owner=B.owner;
insert into t7 select C.owner,B.avg from ownerwithid C left join (select owner,avg(day) as avg from (select owner,datediff(updated,created) as day from review E natural join (select _account_id as owner,review_id from approval where status='MERGED')A)D group by owner) B on C.owner=B.owner;
insert into t8 select C.owner,B.med from ownerwithid C left join (select owner,median(day) as med from (select owner,datediff(updated,created) as day from review E natural join (select _account_id as owner,review_id from approval where status='ABANDONED')A)D group by owner) B on C.owner=B.owner;
insert into t9 select C.owner,B.med from ownerwithid C left join (select owner,median(day) as med from (select owner,datediff(updated,created) as day from review E natural join (select _account_id as owner,review_id from approval where status='MERGED')A)D group by owner) B on C.owner=B.owner;
insert into t10 select E.owner,D.cnt from ownerwithid E left join (select owner,count(*) as cnt from (SELECT review_id as issue,_account_id as owner FROM messages group by review_id,_account_id)A group by owner)D on E.owner=D.owner;
insert into t11 select B.owner,A.cnt from ownerwithid B left join (select _account_id as owner,count(*) as cnt from messages group by _account_id)A on B.owner=A.owner;
insert into t12 select F.owner,E.sum from ownerwithid F left join (select owner,sum(cnt) as sum from (select owner,cnt from (SELECT review_id,_account_id as owner,count(*) as cnt FROM messages group by review_id,_account_id)B natural join review C)D group by owner)E on F.owner=E.owner;
insert into t13 select F.owner,E.sum from ownerwithid F left join (select D.owner,sum(D.cnt) as sum from (select owner,cnt from (SELECT review_id,_account_id as owner,count(*) as cnt FROM messages group by review_id,_account_id)B where (B.owner,B.`review_id`) not in (select _account_id,review_id from review))D group by D.owner)E on F.owner=E.owner;
insert into t14 select E.owner,D.avg from ownerwithid E left join (select C.owner,avg(val) as avg from (select B.`_account_id` as owner,A.val from temp A natural join review B)C group by owner)D on E.owner=D.owner;
insert into t15 select E.owner,D.med from ownerwithid E left join (select C.owner,median(val) as med from (select B.`_account_id` as owner,A.val from temp A natural join review B)C group by owner)D on E.owner=D.owner;
insert into t16 select A.owner,B.cnt from ownerwithid A left join (SELECT _account_id as owner,count(*) as cnt FROM `approval` group by `_account_id`) B on A.owner=B.owner;
insert into t17 select E.owner,D.diff_d from ownerwithid E left join (select A.owner,min(A.min_d) as min, max(A.max_d) as max,datediff(max(A.max_d),min(A.min_d)) as diff_d from (select _account_id as owner,min(CAST(date AS CHAR)) as min_d,max(CAST(date AS CHAR)) as max_d from messages group by `_account_id`)A group by owner)D on E.owner=D.owner;